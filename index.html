<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>To-Do List • Parallax</title>
  <meta name="description" content="Liste de tâches simple avec priorités et effet parallaxe doux. Fonctionne hors ligne et s'installe comme une app.">
  <meta name="theme-color" content="#0ea5e9">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <style>
  :root{--bg:#0b1020;--card:#121a2e;--muted:#97a3b6;--text:#e9eef7;--primary:#0ea5e9;--ring:#38bdf8}
  *{box-sizing:border-box} html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial}
  .container{max-width:860px;margin:0 auto;padding:0 16px} .row{display:flex;gap:16px}.between{justify-content:space-between}.center{align-items:center}
  .topbar{position:sticky;top:0;z-index:30;background:linear-gradient(180deg,rgba(10,15,30,.9),rgba(10,15,30,.6));backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.06)}
  .title{margin:10px 0;font-size:22px;font-weight:700;letter-spacing:.2px} .title::before{content:none!important} h1,h2,h3,ul,ol{list-style:none;margin:0}
  .hero{position:relative;height:42vh;min-height:260px;background-image:linear-gradient(180deg,rgba(2,6,23,.2),rgba(2,6,23,1)),url('https://images.unsplash.com/photo-1506784983877-45594efa4cbe?q=80&w=1600&auto=format&fit=crop');background-size:cover;background-position:center;overflow:hidden}
  .hero-overlay{position:absolute;inset:0;display:flex;align-items:end;padding:32px;background:linear-gradient(180deg,rgba(2,6,23,0),rgba(2,6,23,.7) 30%,rgba(2,6,23,1))}
  .hero-kicker{color:var(--muted);margin:0 0 6px 0} .hero-title{margin:0;font-size:28px;max-width:28ch}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:14px;box-shadow:0 6px 24px rgba(0,0,0,.24)}
  .add-form{display:grid;grid-template-columns:1fr 180px auto;gap:12px;margin-top:-56px}
  .field{display:flex;flex-direction:column;gap:6px}
  input[type="text"],select{background:#0e1530;border:1px solid rgba(255,255,255,.1);color:var(--text);padding:10px 12px;border-radius:12px;outline:none}
  input[type="text"]:focus,select:focus{border-color:var(--ring);box-shadow:0 0 0 3px rgba(56,189,248,.25)}
  .btn{appearance:none;border:1px solid rgba(255,255,255,.12);padding:10px 14px;border-radius:12px;color:var(--text);background:#0f1733;cursor:pointer}
  .btn:hover{filter:brightness(1.1)} .btn.primary{background:var(--primary);border-color:var(--primary);color:white}
  .toolbar{margin-top:16px;display:flex;justify-content:space-between;align-items:center;gap:12px;position:sticky;top:58px;z-index:25}
  .filters{display:flex;gap:8px;flex-wrap:wrap} .chip{border:1px solid rgba(255,255,255,.1);background:#0f1733;color:var(--text);padding:8px 12px;border-radius:999px;cursor:pointer}
  .chip.active{outline:3px solid rgba(56,189,248,.25);border-color:var(--ring)} .count{margin:0;color:var(--muted)}
  .list{margin:16px 0 40px;display:grid;gap:10px;padding:0} .item{display:grid;grid-template-columns:28px 1fr auto;gap:10px;align-items:center;background:#0e1530;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:10px}
  .item.done{opacity:.65} .item input[type="checkbox"]{width:20px;height:20px} .item .text{margin:0;word-break:break-word} .item .text.done{text-decoration:line-through}
  .badge{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.1);margin-right:8px}
  .badge.haute{border-color:rgba(239,68,68,.5);color:#fecaca} .badge.normale{border-color:rgba(56,189,248,.5);color:#bae6fd} .badge.basse{border-color:rgba(34,197,94,.5);color:#bbf7d0}
  .actions{display:flex;gap:6px} .iconbtn{background:transparent;border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:10px;cursor:pointer;color:var(--muted)} .iconbtn:hover{color:var(--text)}
  .footer{padding:24px 0;border-top:1px solid rgba(255,255,255,.06);color:var(--muted);text-align:center}
  .sheet{position:fixed;inset:0;background:rgba(0,0,0,.55);display:grid;place-items:end center;padding:16px}
  .sheet-card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;max-width:520px;width:min(92vw,520px);margin:0 auto 8vh}
  .sheet .muted{color:var(--muted);font-size:14px}
  @media (max-width:720px){.add-form{grid-template-columns:1fr;margin-top:-40px}.toolbar{top:56px;flex-direction:column;align-items:stretch}.filters{justify-content:flex-start}}
  @media (prefers-reduced-motion:reduce){[data-parallax]{transform:none!important}}
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <div class="container row between center">
      <h1 class="title" aria-label="To-Do List">To-Do List</h1>
      <button id="installBtn" class="btn primary" type="button" aria-label="Installer l'application"
              onclick="document.getElementById('installSheet').hidden=false;return false;">Installer</button>
    </div>
  </header>

  <section class="hero" data-parallax aria-hidden="true">
    <div class="hero-overlay">
      <div class="container">
        <p class="hero-kicker">Productif & léger</p>
        <h2 class="hero-title">Votre liste, partout—même hors ligne</h2>
      </div>
    </div>
  </section>

  <main class="container">
    <form id="addForm" class="card add-form" autocomplete="off">
      <div class="field">
        <label for="todoInput">Nouvelle tâche</label>
        <input id="todoInput" name="todo" type="text" placeholder="Ex. Acheter du lait" required minlength="1" maxlength="200" />
      </div>
      <div class="field">
        <label for="prioritySelect">Priorité</label>
        <select id="prioritySelect" name="priority" aria-label="Choisir la priorité">
          <option value="haute">Haute</option>
          <option value="normale" selected>Normale</option>
          <option value="basse">Basse</option>
        </select>
      </div>
      <div class="actions">
        <button class="btn" type="submit">Ajouter</button>
      </div>
    </form>

    <div class="toolbar card">
      <div class="filters" role="tablist" aria-label="Filtres de tâches">
        <button class="chip active" role="tab" aria-selected="true" data-filter="toutes" type="button">Toutes</button>
        <button class="chip" role="tab" aria-selected="false" data-filter="actives" type="button">Actives</button>
        <button class="chip" role="tab" aria-selected="false" data-filter="terminees" type="button">Terminées</button>
      </div>
      <p id="todoCount" class="count" aria-live="polite">0 tâche</p>
    </div>

    <ul id="todoList" class="list" aria-label="Liste de tâches"></ul>
  </main>

  <footer class="footer">
    <div class="container">
      <small>Fonctionne hors ligne • Données enregistrées dans ce navigateur</small>
    </div>
  </footer>

  <div id="installSheet" class="sheet" hidden>
    <div class="sheet-card">
      <h3>Installer l'app</h3>
      <p>Si le bouton système n'apparaît pas :</p>
      <ol>
        <li>Ouvrez le menu du navigateur (⋮).</li>
        <li>Choisissez <strong>Ajouter à l'écran d'accueil</strong>.</li>
        <li>Confirmez <em>Ajouter</em>.</li>
      </ol>
      <p class="muted">Sur iPhone : bouton <em>Partager</em> → <strong>Sur l'écran d'accueil</strong>.</p>
      <button class="btn" type="button" onclick="document.getElementById('installSheet').hidden=true">Fermer</button>
    </div>
  </div>

  <script>
  (function(){
    const KEY='todos_v1'; let todos=[]; let currentFilter='toutes'; let deferredPrompt=null;
    const $=s=>document.querySelector(s), el=id=>document.getElementById(id);

    function load(){ try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch{return[]} }
    function save(){ localStorage.setItem(KEY, JSON.stringify(todos)) }
    function plural(n){ return n+' '+(n===1?'tâche':'tâches') }
    function byFilter(list,f){ if(f==='actives')return list.filter(t=>!t.done); if(f==='terminees')return list.filter(t=>t.done); return list }

    function render(){
      const list=el('todoList'); list.innerHTML=''; const filtered=byFilter(todos,currentFilter);
      for(const t of filtered){
        const li=document.createElement('li'); li.className='item'+(t.done?' done':''); li.dataset.id=t.id;
        const cb=document.createElement('input'); cb.type='checkbox'; cb.checked=t.done; cb.onchange=()=>toggle(t.id);
        const content=document.createElement('div');
        const badge=document.createElement('span'); badge.className='badge '+t.priority; badge.textContent=t.priority[0].toUpperCase()+t.priority.slice(1);
        const p=document.createElement('p'); p.className='text'+(t.done?' done':''); p.textContent=t.text;
        content.appendChild(badge); content.appendChild(p);
        const actions=document.createElement('div'); actions.className='actions';
        const ebtn=document.createElement('button'); ebtn.className='iconbtn'; ebtn.type='button'; ebtn.textContent='Éditer'; ebtn.onclick=()=>inlineEdit(t.id,p);
        const dbtn=document.createElement('button'); dbtn.className='iconbtn'; dbtn.type='button'; dbtn.textContent='Supprimer'; dbtn.onclick=()=>remove(t.id);
        actions.appendChild(ebtn); actions.appendChild(dbtn);
        li.appendChild(cb); li.appendChild(content); li.appendChild(actions); list.appendChild(li);
      }
      el('todoCount').textContent=plural(todos.filter(t=>!t.done).length);
    }
    function add(text,priority='normale'){ const t={id:crypto.randomUUID(),text:text.trim(),priority,done:false,createdAt:Date.now()}; todos=[t,...todos]; save(); render() }
    function toggle(id){ todos=todos.map(t=>t.id===id?{...t,done:!t.done}:t); save(); render() }
    function remove(id){ todos=todos.filter(t=>t.id!==id); save(); render() }
    function inlineEdit(id,pEl){ const t=todos.find(x=>x.id===id); if(!t)return; const inp=document.createElement('input'); inp.type='text'; inp.value=t.text; inp.maxLength=200; inp.className='text'; pEl.replaceWith(inp); inp.focus(); const ok=()=>{ t.text=inp.value.trim()||t.text; save(); render() }; inp.onblur=ok; inp.onkeydown=e=>{ if(e.key==='Enter'){e.preventDefault();inp.blur()} if(e.key==='Escape'){e.preventDefault();render()} } }

    el('addForm').addEventListener('submit',e=>{ e.preventDefault(); const text=el('todoInput').value.trim(); if(!text)return; add(text,el('prioritySelect').value); e.target.reset(); el('todoInput').focus() });
    document.querySelectorAll('.filters .chip').forEach(btn=>{ btn.addEventListener('click',()=>{ document.querySelectorAll('.filters .chip').forEach(b=>{b.classList.remove('active'); b.setAttribute('aria-selected','false')}); btn.classList.add('active'); btn.setAttribute('aria-selected','true'); currentFilter=btn.dataset.filter; render(); }) });

    // Parallax
    const hero=$('[data-parallax]'); let ticking=false;
    function updateP(){ const y=scrollY||0; hero.style.transform='translateY('+(y*0.25)+'px)'; ticking=false }
    if(hero){ addEventListener('scroll',()=>{ if(!ticking){ requestAnimationFrame(updateP); ticking=true } }, {passive:true}) }

    // Service worker
    if('serviceWorker' in navigator){
      addEventListener('load',()=>{ navigator.serviceWorker.register('./sw.js').catch(console.error) });
    }

    function isStandalone(){ return matchMedia('(display-mode: standalone)').matches || navigator.standalone===true }
    function hideInstall(){ el('installBtn').style.display='none'; el('installSheet').hidden=true }
    function showInstall(){ if(!isStandalone()) el('installBtn').style.display='' }

    showInstall();
    addEventListener('beforeinstallprompt',e=>{ e.preventDefault(); deferredPrompt=e; el('installBtn').onclick=async function(){ try{ await deferredPrompt.prompt(); await deferredPrompt.userChoice }catch{} deferredPrompt=null; hideInstall() } });
    addEventListener('appinstalled', hideInstall);

    todos=load(); render();
  })();
  </script>
</body>
</html>
