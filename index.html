<!DOCTYPE html><html lang="fr"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>To-Do List • Parallax</title>
<meta name="theme-color" content="#0ea5e9">
<link rel="manifest" href="/TO-DO-LIST-PARALLAX/manifest.webmanifest?v=3.2">
<style>
:root{--bg:#0b1020;--card:#121a2e;--text:#e9eef7;--muted:#97a3b6;--primary:#0ea5e9}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui}
.container{max-width:860px;margin:0 auto;padding:14px}
.top{position:sticky;top:0;background:rgba(10,15,30,.75);backdrop-filter:blur(8px);border-bottom:1px solid rgba(255,255,255,.06);z-index:10}
h1{margin:8px 0;font-size:22px}
.btn{border:0;background:var(--primary);color:#fff;padding:10px 14px;border-radius:12px;cursor:pointer}
.card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:12px;margin-top:12px}
.list{list-style:none;margin:0;padding:0;display:grid;gap:8px}
.item{display:grid;grid-template-columns:24px 1fr auto;gap:8px;align-items:center;background:#0e1530;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:8px}
.item.done{opacity:.6}.item .t{margin:0}
.badge{font-size:12px;border:1px solid rgba(255,255,255,.1);border-radius:999px;padding:2px 8px;margin-right:8px;color:#bae6fd}
.sheet{position:fixed;inset:0;background:rgba(0,0,0,.5);display:grid;place-items:end center;padding:16px}
.sheet>[role="document"]{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px;max-width:520px;width:min(92vw,520px);margin:0 auto 8vh}
[hidden]{display:none!important}
</style>
</head><body>
<header class="top"><div class="container" style="display:flex;justify-content:space-between;align-items:center;gap:8px">
  <h1>To-Do List</h1>
  <button id="install" class="btn" type="button">Installer</button>
</div></header>

<main class="container">
  <form id="f" class="card" autocomplete="off" style="display:grid;grid-template-columns:1fr 160px auto;gap:8px">
    <input id="txt" placeholder="Nouvelle tâche" required minlength="1" maxlength="200"/>
    <select id="prio"><option value="haute">Haute</option><option value="normale" selected>Normale</option><option value="basse">Basse</option></select>
    <button class="btn">Ajouter</button>
  </form>
  <div class="card" style="display:flex;justify-content:space-between;align-items:center">
    <div>Filtres:
      <button class="btn" id="f_all" type="button" style="background:#26324d">Toutes</button>
      <button class="btn" id="f_active" type="button" style="background:#26324d">Actives</button>
      <button class="btn" id="f_done" type="button" style="background:#26324d">Terminées</button>
    </div>
    <div id="count" style="color:var(--muted)">0 tâche</div>
  </div>
  <ul id="list" class="list" aria-label="tâches"></ul>
</main>

<div id="sheet" class="sheet" role="dialog" aria-modal="true" hidden>
  <div role="document">
    <h3>Installer l'app</h3>
    <ol><li>Ouvrez le menu **⋮** de votre navigateur.</li><li>Choisissez <b>Installer l'application</b> (ou <b>Ajouter à l'écran d'accueil</b>).</li></ol>
    <div style="text-align:right"><button id="close" class="btn" type="button" style="background:#2e3a5a">Fermer</button></div>
  </div>
</div>

<script>
(()=>{const K='todos_v1';let todos=[],filter='all',promptEvt=null;
const $=id=>document.getElementById(id);
function load(){try{return JSON.parse(localStorage.getItem(K)||'[]')}catch{return[]}}
function save(){localStorage.setItem(K,JSON.stringify(todos))}
function plural(n){return n+' '+(n>1?'tâches':'tâche')}
function render(){const ul=$('list');ul.innerHTML='';let arr=todos; if(filter==='active')arr=arr.filter(t=>!t.d); if(filter==='done')arr=arr.filter(t=>t.d);
 for(const t of arr){const li=document.createElement('li');li.className='item'+(t.d?' done':'');li.dataset.id=t.id;
  const cb=document.createElement('input');cb.type='checkbox';cb.checked=t.d;cb.onchange=()=>toggle(t.id);
  const p=document.createElement('p');p.className='t';p.innerHTML='<span class="badge">'+t.p[0].toUpperCase()+t.p.slice(1)+'</span>'+t.txt;
  const del=document.createElement('button');del.textContent='Suppr';del.className='btn';del.style.background='#2e3a5a';del.onclick=()=>rm(t.id);
  li.append(cb,p,del);ul.append(li)}
 $('count').textContent=plural(todos.filter(t=>!t.d).length)}
function add(txt,p){todos=[{id:crypto.randomUUID(),txt,p,d:false},...todos];save();render()}
function toggle(id){todos=todos.map(t=>t.id===id?{...t,d:!t.d}:t);save();render()}
function rm(id){todos=todos.filter(t=>t.id!==id);save();render()}
$('f').addEventListener('submit',e=>{e.preventDefault();const v=$('txt').value.trim();if(!v)return;add(v,$('prio').value);e.target.reset();$('txt').focus()});
$('f_all').onclick=()=>{filter='all';render()};$('f_active').onclick=()=>{filter='active';render()};$('f_done').onclick=()=>{filter='done';render()};
const sheet=$('sheet');const close=$('close');function openSheet(){sheet.hidden=false}function closeSheet(){sheet.hidden=true}
sheet.addEventListener('click',e=>{if(e.target===sheet)closeSheet()});close.onclick=closeSheet;addEventListener('keydown',e=>{if(!sheet.hidden&&e.key==='Escape')closeSheet()});
addEventListener('beforeinstallprompt',e=>{e.preventDefault();promptEvt=e});
$('install').onclick=async()=>{if(promptEvt){promptEvt.prompt();await promptEvt.userChoice;promptEvt=null}else{openSheet()}};
if('serviceWorker' in navigator){addEventListener('load',()=>navigator.serviceWorker.register('/TO-DO-LIST-PARALLAX/sw.js?v=3.2').catch(console.error))}
todos=load();render();})();
</script>
</body></html>
